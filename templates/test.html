<!doctype html>
<html>

<head>
    <title>URL Extractor</title>
</head>

<body>
    <h2>URL Extractor</h2>

    <input type="radio" id="textAreaOption" name="inputOption" checked> Text Area
    <br>
    <textarea id="inputTextArea" rows="5" cols="50"></textarea>

    <br><br>

    <input type="radio" id="fileUploadOption" name="inputOption"> Upload EML File
    <br>
    <input type="file" id="emlFileInput" style="display:none;">
    <br>
    <button id="browseButton" disabled>Select File</button>

    <br><br>

    <button onclick="extractUrls()">Extract URLs</button><br><br>

    <h3>Extracted URLs:</h3>
    <ul id="extractedUrls"></ul>

    <h3>JSON Output:</h3>
    <pre id="jsonOutput"></pre>

    <script>
        // Function to toggle input options based on user's choice
        function toggleInputOption() {
            var textAreaOption = document.getElementById('textAreaOption');
            var fileUploadOption = document.getElementById('fileUploadOption');
            var textArea = document.getElementById('inputTextArea');
            var fileInput = document.getElementById('emlFileInput');
            var browseButton = document.getElementById('browseButton');

            if (textAreaOption.checked) {
                textArea.disabled = false;
                fileInput.disabled = true;
                browseButton.disabled = true;
                browseButton.textContent = "Select File";
            } else if (fileUploadOption.checked) {
                textArea.disabled = true;
                fileInput.disabled = false;
                browseButton.disabled = false;
                browseButton.textContent = "Select File";
            }
        }

        // Event listener to toggle input options
        document.getElementById('textAreaOption').addEventListener('change', toggleInputOption);
        document.getElementById('fileUploadOption').addEventListener('change', toggleInputOption);

        // Event listener for file input change
        document.getElementById('emlFileInput').addEventListener('change', function (event) {
            var fileInput = event.target;
            var browseButton = document.getElementById('browseButton');
            if (fileInput.files.length > 0) {
                var fileName = fileInput.files[0].name;
                var shortFileName = fileName.length > 10 ? fileName.substring(0, 10) + '...' : fileName;
                var fileExtension = fileName.split('.').pop();
                browseButton.textContent = shortFileName + '.' + fileExtension;
            } else {
                browseButton.textContent = "Select File";
            }
        });

        document.getElementById('browseButton').addEventListener('click', function () {
            document.getElementById('emlFileInput').click();
        });


        // Function to extract URLs
        function extractUrls() {
            var inputText;
            var textAreaOption = document.getElementById('textAreaOption');
            var fileUploadOption = document.getElementById('fileUploadOption');
            var fileInput = document.getElementById('emlFileInput');

            if (textAreaOption.checked) {
                inputText = document.getElementById('inputTextArea').value;
            } else if (fileUploadOption.checked) {
                var file = fileInput.files[0];
                var reader = new FileReader();

                reader.onload = function (event) {
                    inputText = event.target.result;
                    fetch('/process_urls', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ text: inputText }),
                    })
                        .then(response => response.json())
                        .then(data => {
                            var extractedUrlsList = document.getElementById('extractedUrls');
                            extractedUrlsList.innerHTML = ''; // Clear the previous list

                            var table = document.createElement('table');
                            table.border = "1";

                            var header = table.createTHead();
                            var row = header.insertRow(0);
                            var cell1 = row.insertCell(0);
                            var cell2 = row.insertCell(1);
                            var cell3 = row.insertCell(2);
                            cell1.innerHTML = "URL";
                            cell2.innerHTML = "Result";
                            cell3.innerHTML = "Malicious Percentage";

                            for (var i = 0; i < data.extracted_urls.length; i++) {
                                var urlData = data.extracted_urls[i];
                                var url = urlData.url;
                                var result = urlData.result;
                                var maliciousPercentage = urlData['malicious percentage'];

                                var listItem = document.createElement('li');
                                listItem.textContent = url;
                                extractedUrlsList.appendChild(listItem);

                                var row = table.insertRow(i + 1);
                                var cell1 = row.insertCell(0);
                                var cell2 = row.insertCell(1);
                                var cell3 = row.insertCell(2);
                                cell1.innerHTML = url;
                                cell2.innerHTML = result;
                                cell3.innerHTML = maliciousPercentage;
                            }

                            document.body.appendChild(table);
                        })
                        .catch(error => console.error('Error:', error));
                };

                reader.readAsText(file);
                return;
            }

            // Fetch request for text area input (similar to what you had before)
            fetch('/process_urls', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: inputText }),
            })
                .then(response => response.json())
                .then(data => {
                    var extractedUrlsList = document.getElementById('extractedUrls');
                    extractedUrlsList.innerHTML = ''; // Clear the previous list

                    var table = document.createElement('table');
                    table.border = "1";

                    var header = table.createTHead();
                    var row = header.insertRow(0);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    cell1.innerHTML = "URL";
                    cell2.innerHTML = "Result";
                    cell3.innerHTML = "Malicious Percentage";

                    for (var i = 0; i < data.extracted_urls.length; i++) {
                        var urlData = data.extracted_urls[i];
                        var url = urlData.url;
                        var result = urlData.result;
                        var maliciousPercentage = urlData['malicious percentage'];

                        var listItem = document.createElement('li');
                        listItem.textContent = url;
                        extractedUrlsList.appendChild(listItem);

                        var row = table.insertRow(i + 1);
                        var cell1 = row.insertCell(0);
                        var cell2 = row.insertCell(1);
                        var cell3 = row.insertCell(2);
                        cell1.innerHTML = url;
                        cell2.innerHTML = result;
                        cell3.innerHTML = maliciousPercentage;
                    }

                    document.body.appendChild(table);
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</body>

</html>
